syntax = "proto3";

package jsbolo;

// NOTE:
// This schema mirrors the current JSON wire shape used by the game runtime.
// Field names intentionally match current TypeScript message models.

enum RangeAdjustment {
  RANGE_ADJUSTMENT_NONE = 0;
  RANGE_ADJUSTMENT_INCREASE = 1;
  RANGE_ADJUSTMENT_DECREASE = 2;
}

enum BuildAction {
  BUILD_ACTION_NONE = 0;
  BUILD_ACTION_FOREST = 1;
  BUILD_ACTION_ROAD = 2;
  BUILD_ACTION_REPAIR = 3;
  BUILD_ACTION_BOAT = 4;
  BUILD_ACTION_BUILDING = 5;
  BUILD_ACTION_PILLBOX = 6;
  BUILD_ACTION_MINE = 7;
}

enum BuilderOrder {
  BUILDER_ORDER_IN_TANK = 0;
  BUILDER_ORDER_WAITING = 1;
  BUILDER_ORDER_RETURNING = 2;
  BUILDER_ORDER_PARACHUTING = 3;
  BUILDER_ORDER_HARVESTING = 10;
  BUILDER_ORDER_BUILDING_ROAD = 11;
  BUILDER_ORDER_REPAIRING = 12;
  BUILDER_ORDER_BUILDING_BOAT = 13;
  BUILDER_ORDER_BUILDING_WALL = 14;
  BUILDER_ORDER_PLACING_PILLBOX = 15;
  BUILDER_ORDER_LAYING_MINE = 16;
}

message BuildOrder {
  BuildAction action = 1;
  uint32 targetX = 2;
  uint32 targetY = 3;
}

message PlayerInput {
  uint32 sequence = 1;
  uint32 tick = 2;
  bool accelerating = 3;
  bool braking = 4;
  bool turningClockwise = 5;
  bool turningCounterClockwise = 6;
  bool shooting = 7;
  BuildOrder buildOrder = 8;
  RangeAdjustment rangeAdjustment = 9;
}

message Tank {
  uint32 id = 1;
  uint32 x = 2;
  uint32 y = 3;
  uint32 direction = 4;
  float speed = 5;
  uint32 armor = 6;
  uint32 shells = 7;
  uint32 mines = 8;
  uint32 trees = 9;
  uint32 team = 10;
  bool onBoat = 11;
  uint32 reload = 12;
  float firingRange = 13;
  optional uint32 carriedPillbox = 14;
}

message Builder {
  uint32 id = 1;
  uint32 ownerTankId = 2;
  uint32 x = 3;
  uint32 y = 4;
  uint32 targetX = 5;
  uint32 targetY = 6;
  BuilderOrder order = 7;
  uint32 trees = 8;
  bool hasMine = 9;
  bool hasPillbox = 10;
  uint32 team = 11;
  uint32 respawnCounter = 12;
}

message Shell {
  uint32 id = 1;
  uint32 x = 2;
  uint32 y = 3;
  uint32 direction = 4;
  sint32 ownerTankId = 5;
}

message Pillbox {
  uint32 id = 1;
  uint32 tileX = 2;
  uint32 tileY = 3;
  uint32 armor = 4;
  uint32 ownerTeam = 5;
  bool inTank = 6;
}

message Base {
  uint32 id = 1;
  uint32 tileX = 2;
  uint32 tileY = 3;
  uint32 armor = 4;
  uint32 shells = 5;
  uint32 mines = 6;
  uint32 ownerTeam = 7;
}

message TerrainUpdate {
  uint32 x = 1;
  uint32 y = 2;
  uint32 terrain = 3;
  uint32 terrainLife = 4;
  optional uint32 direction = 5;
}

message SoundEvent {
  uint32 soundId = 1;
  uint32 x = 2;
  uint32 y = 3;
}

enum HudMessageClass {
  HUD_MESSAGE_CLASS_GLOBAL_NOTIFICATION = 0;
  HUD_MESSAGE_CLASS_ALLIANCE_NOTIFICATION = 1;
  HUD_MESSAGE_CLASS_PERSONAL_NOTIFICATION = 2;
  HUD_MESSAGE_CLASS_CHAT_GLOBAL = 3;
  HUD_MESSAGE_CLASS_CHAT_ALLIANCE = 4;
  HUD_MESSAGE_CLASS_SYSTEM_STATUS = 5;
}

message HudMessage {
  uint64 id = 1;
  uint32 tick = 2;
  HudMessageClass class = 3;
  string text = 4;
}

message WelcomeMap {
  uint32 width = 1;
  uint32 height = 2;
  repeated uint32 terrain = 3;
  repeated uint32 terrainLife = 4;
}

message WelcomeMessage {
  uint32 playerId = 1;
  uint32 assignedTeam = 2;
  uint32 currentTick = 3;
  string mapName = 4;
  WelcomeMap map = 5;
  repeated Tank tanks = 6;
  repeated Pillbox pillboxes = 7;
  repeated Base bases = 8;
  optional bool matchEnded = 9;
  repeated uint32 winningTeams = 10;
}

message UpdateMessage {
  uint32 tick = 1;
  repeated Tank tanks = 2;
  repeated Shell shells = 3;
  repeated Builder builders = 4;
  repeated Pillbox pillboxes = 5;
  repeated Base bases = 6;
  repeated uint32 removedTankIds = 7;
  repeated uint32 removedBuilderIds = 8;
  repeated uint32 removedPillboxIds = 9;
  repeated uint32 removedBaseIds = 10;
  repeated TerrainUpdate terrainUpdates = 11;
  repeated SoundEvent soundEvents = 12;
  optional bool matchEnded = 13;
  repeated uint32 winningTeams = 14;
  repeated HudMessage hudMessages = 15;
}

message ClientMessage {
  oneof payload {
    PlayerInput input = 1;
    ChatMessage chat = 2;
  }
}

message ChatMessage {
  string text = 1;
  bool allianceOnly = 2;
}

message ServerMessage {
  oneof message {
    WelcomeMessage welcome = 1;
    UpdateMessage update = 2;
  }
}
